<!DOCTYPE html>
<html>
<head>
    <title>LCOE Berechnung mit grafischer Auswertung</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1, h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
        }

        .calculator-container {
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            width: 80%;
            max-width: 900px;
        }

        .input-group {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        label {
            display: inline-block;
            width: 250px;
            font-weight: bold;
            color: #555;
        }

        input[type="number"] {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 150px;
            margin-left: 10px;
        }

        #dailyConsumptionResult,
        #capacityResult,
        #costResult {
            margin-left: 10px;
            color: #777;
        }

        button {
            background-color: #5cb85c;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #4cae4c;
        }

        #lcoeTable {
            border-collapse: collapse;
            width: 100%;
            margin-top: 30px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border-radius: 4px;
            overflow: hidden;
        }

        #lcoeTable th,
        #lcoeTable td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        #lcoeTable th {
            background-color: #f0f0f0;
            font-weight: bold;
            color: #333;
        }

        #lcoeTable tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        #lcoeChart {
            margin-top: 30px;
            width: 80%;
            max-width: 900px;
            height: 400px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>

    <div class="calculator-container">
        <h1>LCOE Berechnung für Balkonkraftwerksspeicher</h1>

        <div class="input-group">
            <label for="dailyConsumption">Täglicher Verbrauch (kWh):</label>
            <input type="number" id="dailyConsumption" value="5.00">
            <span id="dailyConsumptionResult">5.00</span>
        </div>

        <div class="input-group">
            <label for="capacity">Batteriekapazität (kWh):</label>
            <input type="number" id="capacity" value="1.92">
            <span id="capacityResult">1.92</span>
        </div>

        <div class="input-group">
            <label for="cost">Kosten des Systems (EUR):</label>
            <input type="number" id="cost" value="800.00">
            <span id="costResult">800.00</span>
        </div>

        <div class="input-group">
            <label for="maxCycles">Maximale Zyklen:</label>
            <input type="number" id="maxCycles" value="6000">
        </div>

        <div class="input-group">
            <label for="maxLifetime">Maximale Lebensdauer (Jahre):</label>
            <input type="number" id="maxLifetime" value="15">
        </div>

        <button onclick="calculateLCOE()">Berechnen</button>

        <h2>LCOE - Berechnung für verschiedene Nutzungsszenarien</h2>
        <table id="lcoeTable">
            <thead>
                <tr>
                    <th>Nutzung (%)</th>
                    <th>Nutzbare Energie pro Zyklus (kWh)</th>
                    <th>% des 5 kWh Verbrauchs gedeckt</th>
                    <th>Tatsächliche Lebensdauer</th>
                    <th>Gesamte Energie (kWh)</th>
                    <th>LCOE (Cent/kWh)</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
    </div>

    <canvas id="lcoeChart"></canvas>

    <script>
        function calculateLCOE() {
            // Daten aus den Eingabefeldern abrufen
            const dailyConsumption = parseFloat(document.getElementById("dailyConsumption").value);
            const capacity = parseFloat(document.getElementById("capacity").value);
            const cost = parseFloat(document.getElementById("cost").value);
            const maxCycles = parseInt(document.getElementById("maxCycles").value);
            const maxLifetime = parseInt(document.getElementById("maxLifetime").value);

            //Ergebnisse der Eingabe anzeigen
            document.getElementById("dailyConsumptionResult").textContent = dailyConsumption.toFixed(2);
            document.getElementById("capacityResult").textContent = capacity.toFixed(2);
            document.getElementById("costResult").textContent = cost.toFixed(2);

            // Tabelle für die LCOE-Ergebnisse
            const lcoeTable = document.getElementById("lcoeTable").getElementsByTagName('tbody')[0];
            lcoeTable.innerHTML = ""; // Tabelle leeren

            // Arrays für die Chart-Daten
            const usageLabels = [];
            const lcoeData = [];

            // Nutzungsszenarien
            const usageScenarios = [100, 80, 70, 50, 40];

            // Berechnungen für jedes Nutzungsszenario
            usageScenarios.forEach(usage => {
                const usageDecimal = usage / 100;
                const usableEnergyPerCycle = capacity * usageDecimal;
                let lifetime = 0;
                let totalEnergy = 0;
                let cyclesPerDay = 0;

                if (usableEnergyPerCycle > 0) {
                    cyclesPerDay = dailyConsumption / usableEnergyPerCycle;
                }

                let lifetimeByCycles = 0;
                if (cyclesPerDay > 0) {
                    lifetimeByCycles = maxCycles / cyclesPerDay / 365;
                }
                const lifetimeByYears = maxLifetime;

                // Anpassung der Lebensdauerberechnung
                lifetime = Math.min(lifetimeByCycles, lifetimeByYears);

                let actualLifetimeInDays = lifetime * 365;
                let maxEnergyByConsumption = dailyConsumption * actualLifetimeInDays;

                let energyByCycles = maxCycles * usableEnergyPerCycle;

                if (lifetime < maxLifetime) {
                    // Lebensdauer ist durch Zyklen begrenzt
                    totalEnergy = Math.min(energyByCycles, maxEnergyByConsumption);
                } else {
                    // Lebensdauer ist durch Jahre begrenzt
                    totalEnergy = maxEnergyByConsumption;
                }

                const lcoe = (cost / totalEnergy) * 100; // Umrechnung in Cent/kWh

                let coveredConsumption = (usableEnergyPerCycle / dailyConsumption) * 100; // Korrigierte Berechnung

                // Neue Zeile zur Tabelle hinzufügen
                let newRow = lcoeTable.insertRow();
                let cell1 = newRow.insertCell(0);
                let cell2 = newRow.insertCell(1);
                let cell3 = newRow.insertCell(2);
                let cell4 = newRow.insertCell(3);
                let cell5 = newRow.insertCell(4);
                let cell6 = newRow.insertCell(5);

                cell1.textContent = usage;
                cell2.textContent = usableEnergyPerCycle.toFixed(2);
                cell3.textContent = coveredConsumption.toFixed(2); // Korrigierte Ausgabe

                // Formatierung der Lebensdauer mit Zyklen pro Tag für ALLE Zeilen
                let lifetimeText = lifetime.toFixed(2) + " Jahre";
                let cyclesPerDayText = "";

                // Berechnung der Zyklen pro Tag für jede Zeile
                let calculatedCyclesPerDay = 0;
                if (lifetime < maxLifetime) {
                    calculatedCyclesPerDay = maxCycles / (lifetime * 365);
                } else {
                    calculatedCyclesPerDay = 5475 / (maxLifetime * 365); // Annahme für Zyklen bei 15 Jahren
                }
                calculatedCyclesPerDay = calculatedCyclesPerDay * usageDecimal; // Berücksichtigung der Nutzung
                cyclesPerDayText = " (ca. " + calculatedCyclesPerDay.toFixed(2) + " Zyklen/Tag)";
                lifetimeText += cyclesPerDayText;
                cell4.textContent = lifetimeText;

                cell5.textContent = totalEnergy.toFixed(2);
                cell6.textContent = lcoe.toFixed(2);

                // Daten für den Chart speichern
                usageLabels.push(usage + "%");
                lcoeData.push(lcoe);
            });

            // Chart erstellen
            const ctx = document.getElementById('lcoeChart').getContext('2d');
            const myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: usageLabels,
                    datasets: [{
                        label: 'LCOE (Cent/kWh)',
                        data: lcoeData,
                        fill: false,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'LCOE (Cent/kWh)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Nutzung (%)'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'LCOE nach Nutzungsszenario',
                            padding: {
                                top: 10,
                                bottom: 30
                            }
                        }
                    }
                }
            });
        }
    </script>

</body>
</html>
